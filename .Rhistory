geom_sf(data = nasc.super.clusters, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf,
aes(X, Y, group = cluster, r = 25000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.mack", "prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"P. mackerel", "Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
pac.mack.color, sardine.color)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
plot.core.clusters.nasc
base.map +
geom_point(data = nasc.plot.ns, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters.ns, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf.ns,
aes(X, Y, group = cluster, r = 25000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.mack", "prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"P. mackerel", "Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
pac.mack.color, sardine.color)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
plot.ns.clusters.nasc <- base.map +
geom_point(data = nasc.plot.ns, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters.ns, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf.ns,
aes(X, Y, group = cluster, r = 25000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.mack", "prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"P. mackerel", "Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
pac.mack.color, sardine.color)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
nasc.plot.combo <- plot.core.clusters.nasc + plot.ns.clusters.nasc +
plot_annotation(tag_levels = c('a'), tag_suffix = ')')
nasc.plot.combo
ggsave(nasc.plot.combo, filename = here("figs/fig_nasc_cluster_combo.png"),
height = 7, width = 8)
plot.ns.clusters.nasc <- base.map +
geom_point(data = nasc.plot.ns, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters.ns, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf.ns,
aes(X, Y, group = cluster, r = 25000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
sardine.color)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
nasc.plot.combo <- plot.core.clusters.nasc + plot.ns.clusters.nasc +
plot_annotation(tag_levels = c('a'), tag_suffix = ')')
ggsave(nasc.plot.combo, filename = here("figs/fig_nasc_cluster_combo.png"),
height = 7, width = 8)
# Plot averaged cps NASC with nearest neighbor polygons
plot.core.clusters.nasc <- base.map +
geom_point(data = nasc.plot.core, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf,
aes(X, Y, group = cluster, r = 25000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.mack", "prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"P. mackerel", "Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
pac.mack.color, sardine.color)) +
# Configure legend guides
guides(fill   = guide_legend(order = 1),
size   = guide_legend(order = 1))
plot.core.clusters.nasc
# Plot averaged cps NASC with nearest neighbor polygons
plot.core.clusters.nasc <- base.map +
geom_point(data = nasc.plot.core, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf,
aes(X, Y, group = cluster, r = 25000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.mack", "prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"P. mackerel", "Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
pac.mack.color, sardine.color)) +
# Configure legend guides
guides(fill   = guide_legend(order = 1),
size   = guide_legend(order = 1)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
plot.core.clusters.nasc
# Plot averaged cps NASC with nearest neighbor polygons
plot.core.clusters.nasc <- base.map +
geom_point(data = nasc.plot.core, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf,
aes(X, Y, group = cluster, r = 25000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.mack", "prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"P. mackerel", "Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
pac.mack.color, sardine.color)) +
# # Configure legend guides
# guides(fill   = guide_legend(order = 1),
#        size   = guide_legend(order = 1)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
plot.ns.clusters.nasc <- base.map +
geom_point(data = nasc.plot.ns, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters.ns, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf.ns,
aes(X, Y, group = cluster, r = 25000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
sardine.color)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
nasc.plot.combo <- plot.core.clusters.nasc + plot.ns.clusters.nasc +
plot_annotation(tag_levels = c('a'), tag_suffix = ')')
ggsave(nasc.plot.combo, filename = here("figs/fig_nasc_cluster_combo.png"),
height = 7, width = 8)
# Plot averaged cps NASC with nearest neighbor polygons
plot.core.clusters.nasc <- base.map +
geom_point(data = nasc.plot.core, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf,
aes(X, Y, group = cluster, r = 10000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.mack", "prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"P. mackerel", "Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
pac.mack.color, sardine.color)) +
# # Configure legend guides
# guides(fill   = guide_legend(order = 1),
#        size   = guide_legend(order = 1)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
plot.ns.clusters.nasc <- base.map +
geom_point(data = nasc.plot.ns, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters.ns, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf.ns,
aes(X, Y, group = cluster, r = 10000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
sardine.color)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
nasc.plot.combo <- plot.core.clusters.nasc + plot.ns.clusters.nasc +
plot_annotation(tag_levels = c('a'), tag_suffix = ')')
ggsave(nasc.plot.combo, filename = here("figs/fig_nasc_cluster_combo.png"),
height = 7, width = 8)
# Plot averaged cps NASC with nearest neighbor polygons
plot.core.clusters.nasc <- base.map +
geom_point(data = nasc.plot.core, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf,
aes(X, Y, group = cluster, r = 15000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.mack", "prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"P. mackerel", "Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
pac.mack.color, sardine.color)) +
# # Configure legend guides
# guides(fill   = guide_legend(order = 1),
#        size   = guide_legend(order = 1)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
plot.ns.clusters.nasc <- base.map +
geom_point(data = nasc.plot.ns, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters.ns, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf.ns,
aes(X, Y, group = cluster, r = 15000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.sar"),
alpha = 0.5) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
sardine.color)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
nasc.plot.combo <- plot.core.clusters.nasc + plot.ns.clusters.nasc +
plot_annotation(tag_levels = c('a'), tag_suffix = ')')
ggsave(nasc.plot.combo, filename = here("figs/fig_nasc_cluster_combo.png"),
height = 7, width = 8)
plot.ns.clusters.nasc <- base.map +
geom_point(data = nasc.plot.ns, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75, show.legend = FALSE) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters.ns, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf.ns,
aes(X, Y, group = cluster, r = 15000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.sar"),
alpha = 0.5, show.legend = FALSE) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
sardine.color)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
plot.ns.clusters.nasc
plot.ns.clusters.nasc <- base.map +
geom_point(data = nasc.plot.ns, aes(X, Y, size = bin, fill = bin),
shape = 21, alpha = 0.75, show.legend = FALSE) +
# Configure size and colour scales
scale_size_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.sizes.all,labels = nasc.labels.all) +
scale_fill_manual(name = bquote(atop(italic(s)[A], ~'(m'^2 ~'nmi'^-2*')')),
values = nasc.colors.all, labels = nasc.labels.all) +
geom_sf(data = nasc.super.clusters.ns, fill = NA) +
ggnewscale::new_scale_fill() +
geom_scatterpie(data = clf.ns,
aes(X, Y, group = cluster, r = 15000),
cols = c("prop.anch","prop.her","prop.jack",
"prop.sar"),
alpha = 0.5, show.legend = FALSE) +
# Configure trawl scale
scale_fill_manual(name = 'Species',
labels = c("Anchovy", "P. herring", "J. mackerel",
"Sardine"),
values = c(anchovy.color, pac.herring.color, jack.mack.color,
sardine.color)) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"]-100000, map.bounds["xmax"]+100000)),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
nasc.plot.combo <- plot.core.clusters.nasc + plot.ns.clusters.nasc +
plot_annotation(tag_levels = c('a'), tag_suffix = ')')
ggsave(nasc.plot.combo, filename = here("figs/fig_nasc_cluster_combo.png"),
height = 7, width = 8)
# Chunk 2: setup
# Install and load pacman (library management package)
if (!require("pacman")) install.packages("pacman")
# Install and load required packages from CRAN ---------------------------------
pacman::p_load(tidyverse, gt, lubridate, here, odbc, patchwork,
mapview, fs)
# Install and load required packages from Github -------------------------------
# surveyR
pacman::p_load_gh("kstierhoff/atm")
# Chunk 3: user-controls
# Import data; else use existing data
import.data <- FALSE
save.figs   <- FALSE
# Source net data
source(here("Code/1-load-data.R"))
savehistory("C:/KLS/CODE/Github/atm-net-sampling/lost-history.Rhistory")
install.packages("ggmapinset")
remotes::install_github("hughjonesd/ggmagnify")
# Chunk 2: setup
# Install and load pacman (library management package)
if (!require("pacman")) install.packages("pacman")
# Install and load required packages from CRAN ---------------------------------
pacman::p_load(tidyverse, gt, lubridate, here, odbc, patchwork,
mapview, fs, sf)
# Install and load required packages from Github -------------------------------
# surveyR
pacman::p_load_gh("kstierhoff/atm")
# Chunk 3: user-controls
# Import data; else use existing data
import.data <- FALSE
save.figs   <- FALSE
# Chunk 4: user-options
# Mapping options
crs.proj <- 3310
crs.geog <- 4326
map.height <- 10
# Chunk 5: source-data
# Source data
source(here("Code/1-load-data.R"))
# Chunk 6
# Chunk 7
# Chunk 8
#| eval: false
map.bounds <- nasc.core %>%
st_as_sf(coords = c("long", "lat"), crs = crs.geog) %>%
st_transform(crs = crs.proj) %>%
st_bbox()
map.aspect <- (map.bounds$xmax - map.bounds$xmin)/(map.bounds$ymax - map.bounds$ymin)
map.width  <- map.height*map.aspect
load(here("Data/map/basemap.Rdata"))
transects <- read_csv(here("Data/maps/waypoints_1907RL.csv")) %>%
st_as_sf(coords = c("Longitude","Latitude"), crs = crs.geog) %>%
group_by(Type, Transect, Region) %>%
summarise(do_union = F) %>%
st_cast("LINESTRING") %>%
filter(Type %in% c("Adaptive","Compulsory","Nearshore"))
transects <- read_csv(here("Data/map/waypoints_1907RL.csv")) %>%
st_as_sf(coords = c("Longitude","Latitude"), crs = crs.geog) %>%
group_by(Type, Transect, Region) %>%
summarise(do_union = F) %>%
st_cast("LINESTRING") %>%
filter(Type %in% c("Adaptive","Compulsory","Nearshore"))
base.map +
geom_sf(data = transects) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"], map.bounds["xmax"])),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
str(transects)
unique(transects$Region)
library(ggmagnify)
base.map +
geom_magnify(data = transects,
aes(from = Region == "WA/OR"),
to = c(-125, -98, 10, 30),
shadow = TRUE, linewidth = 1, colour = "blue",
shape = "outline",
aspect = "fixed",
expand = 0)
install.packages("ggfx")
# Chunk 2: setup
# Install and load pacman (library management package)
if (!require("pacman")) install.packages("pacman")
# Install and load required packages from CRAN ---------------------------------
pacman::p_load(tidyverse, gt, lubridate, here, odbc, patchwork,
mapview, fs, sf)
# Install and load required packages from Github -------------------------------
# surveyR
pacman::p_load_gh("kstierhoff/atm")
# Chunk 3: user-controls
# Import data; else use existing data
import.data <- FALSE
save.figs   <- FALSE
# Chunk 4: user-options
# Mapping options
crs.proj <- 3310
crs.geog <- 4326
map.height <- 10
# Chunk 5: source-data
# Source data
source(here("Code/1-load-data.R"))
# Chunk 6
# Chunk 7
# Chunk 8
#| eval: false
map.bounds <- nasc.core %>%
st_as_sf(coords = c("long", "lat"), crs = crs.geog) %>%
st_transform(crs = crs.proj) %>%
st_bbox()
map.aspect <- (map.bounds$xmax - map.bounds$xmin)/(map.bounds$ymax - map.bounds$ymin)
map.width  <- map.height*map.aspect
load(here("Data/map/basemap.Rdata"))
transects <- read_csv(here("Data/map/waypoints_1907RL.csv")) %>%
st_as_sf(coords = c("Longitude","Latitude"), crs = crs.geog) %>%
group_by(Type, Transect, Region) %>%
summarise(do_union = F) %>%
st_cast("LINESTRING") %>%
filter(Type %in% c("Adaptive","Compulsory","Nearshore"))
base.map +
geom_sf(data = transects) +
coord_sf(crs = crs.proj, # CA Albers Equal Area Projection
xlim = unname(c(map.bounds["xmin"], map.bounds["xmax"])),
ylim = unname(c(map.bounds["ymin"], map.bounds["ymax"])))
library(ggmagnify)
map.bounds.ns <- nasc.ns %>%
st_as_sf(coords = c("long", "lat"), crs = crs.geog) %>%
st_transform(crs = crs.proj) %>%
st_bbox()
map.bounds.ns
map.bounds.ns$xmin
base.map +
geom_magnify(data = transects,
aes(from = Region == "WA/OR"),
to = c(map.bounds.ns$xmin, map.bounds.ns$xmax,
map.bounds.ns$ymin, map.bounds.ns$ymax),
shadow = TRUE, linewidth = 1, colour = "blue",
shape = "outline",
aspect = "fixed",
expand = 0)
